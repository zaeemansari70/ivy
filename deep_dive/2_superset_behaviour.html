<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Superset Behaviour &mdash; Ivy 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="icon" type="image/png" href="https://github.com/unifyai/unifyai.github.io/blob/master/img/externally_linked/ivy_logo_only.png?raw=true">
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Backend Setting" href="3_backend_setting.html" />
    <link rel="prev" title="Function Types" href="1_function_types.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Ivy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../deep_dive.html">Deep Dive</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0_navigating_the_code.html">Navigating the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_function_types.html">Function Types</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Superset Behaviour</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ivy-linspace">ivy.linspace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ivy-eye">ivy.eye</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ivy-scatter-nd">ivy.scatter_nd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ivy-logical-and">ivy.logical_and</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="3_backend_setting.html">Backend Setting</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_function_wrapping.html">Function Wrapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_arrays.html">Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_containers.html">Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="7_data_types.html">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="8_devices.html">Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="9_inplace_updates.html">Inplace Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_formatting.html">Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_function_arguments.html">Function Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_docstrings.html">Docstrings</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_docstring_examples.html">Docstring Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="14_array_api_tests.html">Array API Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="15_ivy_tests.html">Ivy Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="16_ivy_frontends.html">Ivy Frontends</a></li>
<li class="toctree-l2"><a class="reference internal" href="17_ivy_frontends_tests.html">Ivy Frontend Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/compilation.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/constants.html">Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/creation.html">Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/data_type.html">Data type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/device.html">Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/elementwise.html">Elementwise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/general.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/gradients.html">Gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/linear_algebra.html">Linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/losses.html">Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/manipulation.html">Manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/meta.html">Meta</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/nest.html">Nest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/random.html">Random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/searching.html">Searching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/set.html">Set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/sorting.html">Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/statistical.html">Statistical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/utility.html">Utility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_classes/container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_classes/array.html">Array</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Framework Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../stateful/initializers.html">Initializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/optimizers.html">Optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/module.html">Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/sequential.html">Sequential</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ivy"">Ivy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mech"">Ivy mech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vision"">Ivy vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robot"">Ivy robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gym"">Ivy gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../memory"">Ivy memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../builder"">Ivy builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models"">Ivy models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem"">Ivy ecosystem</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ivy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../contributing.html">Contributing</a> &raquo;</li>
          <li><a href="../deep_dive.html">Deep Dive</a> &raquo;</li>
      <li>Superset Behaviour</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/deep_dive/2_superset_behaviour.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="superset-behaviour">
<h1>Superset Behaviour<a class="headerlink" href="#superset-behaviour" title="Permalink to this heading"></a></h1>
<p>When implementing functions in Ivy, we are constantly faced with the question: which
backend implementation should Ivy most closely follow?</p>
<p>It might seem as though this question is already answered.
Ivy fully adheres to the <a class="reference external" href="https://data-apis.org/array-api/latest/">Array API Standard</a>, which helpfully limits our design space
for the functions, but in its current form this only covers a relatively small number of
functions which together make up less than half of the functions in Ivy.
Even for Ivy functions which adhere to the standard,
the standard permits the addition of extra arguments and function features,
provided that they do not contradict the requirements of the standard.
Therefore, we are still faced with the same kind of design decisions for all Ivy
functions, even those appearing in the <a class="reference external" href="https://data-apis.org/array-api/latest/">Array API Standard</a>.</p>
<p>In this section, we explain through examples how Ivy always goes for the superset of
functionality among the backend frameworks. This is not always totally possible,
and in some cases certain framework-specific features must be sacrificed,
but usually it’s possible to implement a very generalized function which covers most of
the unique features among the corresponding functions in each framework.</p>
<p>Despite this general approach, the total superset is not always strived for, especially
in cases where the behaviour can very easily be replicated by a simple composition of
other functions, or where the extra behaviour is redundant as it is already covered by
another function.
As an example, many pointwise functions in NumPy support the <code class="code docutils literal notranslate"><span class="pre">where</span></code> argument,
which enables a mask array to be specified, with the function then only evaluated
at elements for which the <code class="code docutils literal notranslate"><span class="pre">where</span></code> array is <code class="code docutils literal notranslate"><span class="pre">True</span></code>.
This inclusion of this feature in NumPy is totally understandable,
compositions of NumPy functions are never compiled into computation graph which span
multiple operations, and therefore a good way to maximize efficiency of NumPy code is to
minimize the number of unique NumPy functions which are called, each of which are
implemented with very high efficiency in <code class="code docutils literal notranslate"><span class="pre">C</span></code>. In this case, the inclusion of
<code class="code docutils literal notranslate"><span class="pre">where</span></code> as an argument also prevents unnecessary values from being computed,
only to be masked out in the immediately subsequent operation.
For these reasons, calling <code class="code docutils literal notranslate"><span class="pre">np.absolute(x,</span> <span class="pre">where=mask)</span></code> is much better than
calling <code class="code docutils literal notranslate"><span class="pre">np.where(mask,</span> <span class="pre">np.absolute(x),</span> <span class="pre">np.empty_like(x))</span></code> in NumPy.
However, other frameworks are able to compile compositions of python operations directly
to computation graphs in low-level languages, and are also able to intelligently fuse
operations into combined kernels, via libraries such as
<a class="reference external" href="https://github.com/NVIDIA/TensorRT">TensorRT</a>.
This removes the need for highly general function signatures such as those found in
NumPy. Instead, a compositional approach is preferred, where each function in Python
serves a particular and non-overlapping purpose.
This helps to keep things more clean and clear at the Python level,
without sacrificing efficiency at the lower level.</p>
<p>We now take a look at some examples, and explain our rational for deciding upon the
function signature that we should use in Ivy. The first three examples are more-or-less
superset examples, while the last example involves a deliberate decision to not
implement the full superset, for the reason explained above.</p>
<section id="ivy-linspace">
<h2>ivy.linspace<a class="headerlink" href="#ivy-linspace" title="Permalink to this heading"></a></h2>
<p>When looking at the <code class="code docutils literal notranslate"><span class="pre">linspace</span></code> (or closest equivalent) implementations for
<a class="reference external" href="https://lets-unify.ai/ivy/functional/ivy/creation/linspace/linspace_functional.html">Ivy</a>,
<a class="reference external" href="https://jax.readthedocs.io/en/latest/_autosummary/jax.numpy.linspace.html">JAX</a>,
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linspace.html">NumPy</a>,
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/linspace">TensorFlow</a>,
and
<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.linspace.html">PyTorch</a>,
we can see that <code class="code docutils literal notranslate"><span class="pre">torch</span></code> does not support arrays for the <code class="code docutils literal notranslate"><span class="pre">start</span></code> and
<code class="code docutils literal notranslate"><span class="pre">end</span></code> arguments, while <code class="code docutils literal notranslate"><span class="pre">jax</span></code>, <code class="code docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="code docutils literal notranslate"><span class="pre">tensorflow</span></code> all do.
Likewise, Ivy also supports arrays for the <code class="code docutils literal notranslate"><span class="pre">start</span></code> and <code class="code docutils literal notranslate"><span class="pre">stop</span></code> arguments,
and in doing so provides the generalized superset implementation among the backend
frameworks.</p>
</section>
<section id="ivy-eye">
<h2>ivy.eye<a class="headerlink" href="#ivy-eye" title="Permalink to this heading"></a></h2>
<p>When looking at the <code class="code docutils literal notranslate"><span class="pre">eye</span></code> (or closest equivalent) implementations for
<a class="reference external" href="https://lets-unify.ai/ivy/functional/ivy/creation/eye/eye_functional.html">Ivy</a>,
<a class="reference external" href="https://jax.readthedocs.io/en/latest/_autosummary/jax.numpy.eye.html">JAX</a>,
<a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.eye.html">NumPy</a>,
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/eye">TensorFlow</a>,
and
<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.eye.html">PyTorch</a>,
we can see that <code class="code docutils literal notranslate"><span class="pre">tensorflow</span></code> is the only framework which supports a
<code class="code docutils literal notranslate"><span class="pre">batch_shape</span></code> argument. Likewise, Ivy also supports a <code class="code docutils literal notranslate"><span class="pre">batch_shape</span></code>
argument, and in doing so provides the generalized superset implementation among the
backend frameworks.</p>
</section>
<section id="ivy-scatter-nd">
<h2>ivy.scatter_nd<a class="headerlink" href="#ivy-scatter-nd" title="Permalink to this heading"></a></h2>
<p>When looking at the <code class="code docutils literal notranslate"><span class="pre">scatter_nd</span></code> (or closest equivalent) implementations for
<a class="reference external" href="https://lets-unify.ai/ivy/functional/ivy/general/scatter_nd/scatter_nd_functional.html">Ivy</a>,
<a class="reference external" href="https://jax.readthedocs.io/en/latest/_autosummary/jax.numpy.ndarray.at.html#jax.numpy.ndarray.at">JAX</a>,
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.at.html">NumPy</a>,
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/scatter_nd">TensorFlow</a>,
and
<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.scatter.html">PyTorch</a>,
we can see that <code class="code docutils literal notranslate"><span class="pre">torch</span></code> only supports scattering along a single dimension,
while all other frameworks support scattering across multiple dimensions at once.
Likewise, Ivy also supports scattering across multiple dimensions at once,
and in doing so provides the generalized superset implementation among the backend
frameworks.</p>
</section>
<section id="ivy-logical-and">
<h2>ivy.logical_and<a class="headerlink" href="#ivy-logical-and" title="Permalink to this heading"></a></h2>
<p>When looking at the <code class="code docutils literal notranslate"><span class="pre">logical_and</span></code> (or closest equivalent) implementations for
<a class="reference external" href="https://lets-unify.ai/ivy/functional/ivy/elementwise/logical_and/logical_and_functional.html">Ivy</a>,
<a class="reference external" href="https://jax.readthedocs.io/en/latest/_autosummary/jax.numpy.logical_and.html">JAX</a>,
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.logical_and.html">NumPy</a>,
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/math/logical_and">TensorFlow</a>,
and
<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.logical_and.html">PyTorch</a>,
we can see that <code class="code docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="code docutils literal notranslate"><span class="pre">torch</span></code> support the <code class="code docutils literal notranslate"><span class="pre">out</span></code> argument for
performing inplace updates, while <code class="code docutils literal notranslate"><span class="pre">jax</span></code> and <code class="code docutils literal notranslate"><span class="pre">tensorflow</span></code> do not.
With regards to the supported data types, <code class="code docutils literal notranslate"><span class="pre">jax</span></code>, <code class="code docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="code docutils literal notranslate"><span class="pre">torch</span></code>
support numeric arrays, while <code class="code docutils literal notranslate"><span class="pre">tensorflow</span></code> supports only boolean arrays.
With regards to both of these points, Ivy provides the generalized superset
implementation among the backend frameworks, with support for the <code class="code docutils literal notranslate"><span class="pre">out</span></code> argument
and also support for both numeric and boolean arrays in the input.</p>
<p>However, as discussed above, <code class="code docutils literal notranslate"><span class="pre">np.logical_and</span></code> also supports the <code class="code docutils literal notranslate"><span class="pre">where</span></code>
argument, which we opt to <strong>not</strong> support in Ivy. This is because the behaviour can
easily be created as a composition like so
<code class="code docutils literal notranslate"><span class="pre">ivy.where(mask,</span> <span class="pre">ivy.logical_and(x,</span> <span class="pre">y),</span> <span class="pre">ivy.zeros_like(mask))</span></code>,
and we prioritize the simplicity, clarity, and function uniqueness in Ivy’s API in this
case, which comes at the cost of reduced runtime efficiency for some functions when
using a NumPy backend. However, in future releases our automatic graph compilation and
graph simplification processes will alleviate these minor inefficiencies entirely from
the final computation graph, by fusing multiple operations into one at the API level
where possible.</p>
<p><strong>Round Up</strong></p>
<p>This should have hopefully given you a good feel what should and should not be included
when deciding how to design a new Ivy function.
In many cases, there is not a clear right and wrong answer, and we arrive at the final
decision via open discussion. If you find yourself proposing the addition of a new
function in Ivy, then we will most likely have this discussion on your Pull Request!</p>
<p>If you’re ever unsure of how best to proceed,
please feel free to engage with the <a class="reference external" href="https://github.com/unifyai/ivy/discussions/4367">superset behavior discussion</a>,
or reach out on <a class="reference external" href="https://discord.gg/ZVQdvbzNQJ">discord</a> in the <a class="reference external" href="https://discord.com/channels/799879767196958751/1018954266322419732">superset behavior channel</a>!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="1_function_types.html" class="btn btn-neutral float-left" title="Function Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3_backend_setting.html" class="btn btn-neutral float-right" title="Backend Setting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Ivy Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>